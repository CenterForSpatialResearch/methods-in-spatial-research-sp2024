<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.8"/><style data-href="/methods-in-spatial-research-sp2024/styles.d705a0b6891743f7bef9.css" data-identity="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Karla:ital,wght@0,400;0,700;1,400;1,700&family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400;1,700&family=Poppins:ital,wght@0,300;0,400;0,700;1,400;1,700&family=Roboto+Mono:wght@400&display=swap);code[class*=language-],pre[class*=language-]{word-wrap:normal;color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#073642}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{background:#eee8d5;color:#657b83}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.layout-module--container--78b04{font-family:Karla,sans-serif;margin:auto;max-width:800px}.layout-module--heading--f158c{color:#030303}.layout-module--nav-links--1113b{display:flex;list-style:none;padding-left:0}.layout-module--nav-link-item--a5f0a{padding-right:2rem}.layout-module--nav-link-text--69cda{color:#000}.layout-module--site-title--e4dea{color:#000;font-size:1rem;font-weight:700;margin:2rem 0}a{color:#000}a:hover{background-color:#d9ff00}.layout-module--caption--95d12{font-size:.25rem}code{font-feature-settings:"clig" 0,"calt" 0;word-wrap:break-word;background:#ffeff0;border-radius:.1rem;-webkit-box-decoration-break:clone;box-decoration-break:clone;font-family:Roboto Mono,monospace;font-size:90%}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--container--78b04"><title>Webmaps Part 1 - Making a Basic Webmap<!-- -->| <!-- -->A4407-sp2024</title><header class="layout-module--site-title--e4dea">A4407-sp2024</header><nav><ul class="layout-module--nav-links--1113b"><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/methods-in-spatial-research-sp2024/">Home</a></li><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/methods-in-spatial-research-sp2024/tutorials">Tutorials</a></li><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/methods-in-spatial-research-sp2024/assignments">Assignments</a></li><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/methods-in-spatial-research-sp2024/resources">Resources</a></li></ul></nav><main><h1 class="layout-module--heading--f158c">Webmaps Part 1 - Making a Basic Webmap</h1><h1>Step 1: Setting up Github and Mapbox</h1><p>This tutorial is an introduction to making web maps using <a href="https://www.mapbox.com/mapbox-gl-js/api/">Mapbox GL JS</a>. This is a recent javascript library that uses <a href="https://en.wikipedia.org/wiki/WebGL">WebGL</a> to render interactive maps from vector tiles (as opposed to raster tiles) created with <a href="https://www.mapbox.com/mapbox-studio/">Mapbox Studio</a>. Data for these maps comes from <a href="https://www.openstreetmap.org">OpenStreetMap</a>.</p><p>This tutorial will introduce you to the basic setup and what it feels like to develop for a web browser, how to add datasets, and then how to make those datasets interactive. This will be a very different approach than your experience thus far in QGIS, and it is much more prone to error given the number of new concepts and syntaxes involved. Brackets, commas, quotes, and colons... stay with it—it&#x27;s ok if you don&#x27;t understand what everything is doing at first.</p><h2>Setup Prerequisites</h2><p>To publish the web map you will create in this tutorial we will use <a href="https://en.wikipedia.org/wiki/GitHub">GitHub</a>. This website provides hosting for software development (a website is a kind of software...) version control using <a href="https://en.wikipedia.org/wiki/Git">Git</a>. Git is a system for tracking changes in software development. (You can think of it like a very sophisticated version of Microsoft Word&#x27;s track changes function, and in fact you can use it in this way for <a href="https://programminghistorian.org/en/lessons/sustainable-authorship-in-plain-text-using-pandoc-and-markdown">writing</a>.) This tutorial will walk you through how to use Git with GitHub to track changes you make to your web map. However, it does not cover the mechanics of Git or GitHub.</p><p>Using GitHub will allow us to easily host our web maps online, however it requires a bit of set up.</p><p>At this stage, you should:</p><ol><li>create a <a href="https://github.com">GitHub</a> account if you don&#x27;t already have one</li><li>create a new repository on GitHub<ul><li>from the <strong>Your Profile</strong> page in your newly created github account select <strong>Repositories</strong></li><li>select the green <strong>New</strong> button in the top right of the page</li><li>name this repository <code>webmap_1</code></li><li>select <strong>Initialize this repository with a README</strong></li><li>select <strong>Create Repository</strong>  </li></ul></li></ol><p><img src="images/157/webmap_1_16.png" alt="repository"/>    </p><ol start="3"><li>set up your repository as a <a href="https://pages.github.com/">GitHub page</a> (a project site from scratch)</li></ol><ul><li>from the new repository you&#x27;ve just created select <strong>Settings</strong></li><li>scroll down to <strong>GitHub Pages</strong> and select <code>Master Branch</code> as the <strong>Source</strong></li></ul><ol start="4"><li><p>install <a href="https://git-scm.com/downloads">Git</a>.</p><ul><li>download and install the git version for your operating system. Follow the instructions of the installer.</li><li>Note that if you&#x27;re using a Mac, this will just install the Git command-line program, which you can access through the Terminal app. On Windows, you&#x27;ll get the command-line Git plus a new Terminal-like app called Git Bash.</li></ul></li><li><p>use Git in the Terminal or Git Bash to clone the repository you created on github.</p><ul><li><strong>On Mac</strong> open your terminal (Applications &gt; Utilities &gt; Terminal.app); <strong>on PC</strong> open Git Bash (Programs &gt; Git &gt; Git Bash, or search for it in the start menu).</li><li>and learned how to <a href="https://www.macworld.com/article/2042378/master-the-command-line-navigating-files-and-folders.html">navigate</a>;</li><li>navigate to the folder where you would like to create your web map.</li><li>set up git, type the following in your terminal/git bash:<br/><code>git config --global user.name &#x27;Your Name&#x27;</code><br/><code>git config --global user.email &#x27;email@wherever.com&#x27;</code> (this email should match the one you used to set up Github)</li><li>cloned a local copy of your repository to your computer using git.<ul><li>by typing: <code>git clone https://github.com/yourusername/webmap_1</code></li></ul></li></ul></li></ol><h4>Create empty files that will become your web map and <code>commit</code> your first changes, and <code>push</code> them to GitHub</h4><ol start="6"><li>open your text editor (<a href="https://code.visualstudio.com/">VS Code</a> is a good one) and create three empty files titled <code>index.html</code>, <code>style.css</code>, and <code>map.js</code>. <strong>Save</strong> them in your <code>webmap_1</code> folder. Your <code>webmap_1</code> folder should look like this:  </li></ol><p><img src="images/157/webmap_1_17.png" alt="initial folder"/></p><ol start="7"><li>add the files you just created to your repository, to do this in your Terminal/Git Bash type:</li></ol><ul><li><code>git add index.html style.css map.js</code></li></ul><ol start="8"><li>&quot;commit&quot; and &quot;push&quot; your changes:<ul><li>in Git Bash or Terminal type:<ul><li><code>git commit -m &#x27;initial import&#x27;</code>
and then</li><li><code>git push</code>  </li></ul></li></ul></li><li>view the result on your online github repository (the url should be <code>github.com/yourusername/webmap_1</code>) github page (the url should be <code>yourgithubusername.github.io/webmap_1</code> but you can also find this in the settings of the repository you created on github). You should see something like this:  </li></ol><p><img src="images/157/webmap_1_21.png" alt="initial webpage"/></p><h2>A web page</h2><p>HTML is the structure of a web page, css is the style, and javascript is the functionality or the interaction. Each of these are contained in text files with the appropriate extension—and they each have entirely different syntax. When you are creating a website you are creating a series of linked files that your browser downloads and uses to construct the display. These files can also come from remote resources, such as in the case of javascript libraries or map tiles.</p><p><img src="images/157/webmap_1_17.png" alt="initial folder"/></p><p>HTML is defined by a series of tags, which are either in the form <code>&lt;tag /&gt;</code> or <code>&lt;tag&gt;&lt;/tag&gt;</code>. A comment in HTML, which is simply a non-functional bit of text meant to explicate the code, is in the form <code>&lt;!-- comment --&gt;</code>. Reproduce the following in your <code>index.html</code> file using your text editor (you can copy and paste).</p><pre><code class="language-html">&lt;!DOCTYPE html&gt; &lt;!-- let the browser know this is an HTML file --&gt;

&lt;html&gt;      &lt;!-- everything else is enclosed in html tags --&gt;
&lt;head&gt;      &lt;!-- the head is for metadata prior to building the page --&gt;

    &lt;!-- define the character set --&gt;
    &lt;meta charset=&#x27;utf-8&#x27; /&gt;    

    &lt;!-- the title of the page which will show up in the browser bar --&gt;
    &lt;title&gt;Map Test&lt;/title&gt;     

    &lt;!-- discourage the browser from caching the page --&gt;    
    &lt;meta http-equiv=&#x27;Cache-Control&#x27; content=&#x27;no-cache, no-store, must-revalidate&#x27; /&gt;
    &lt;meta http-equiv=&#x27;Pragma&#x27; content=&#x27;no-cache&#x27; /&gt;
    &lt;meta http-equiv=&#x27;Expires&#x27; content=&#x27;0&#x27; /&gt;    

    &lt;!-- tells mobile devices how to scale the page --&gt;    
    &lt;meta name=&#x27;viewport&#x27; content=&#x27;initial-scale=1,maximum-scale=1,user-scalable=no&#x27; /&gt;

    &lt;!-- stylesheet links --&gt;
    &lt;link href=&#x27;https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css&#x27; rel=&#x27;stylesheet&#x27; /&gt;     
    &lt;link href=&#x27;style.css&#x27; rel=&#x27;stylesheet&#x27; /&gt;

    &lt;!-- javascript links --&gt;
    &lt;script src=&#x27;https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js&#x27;&gt;&lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;      &lt;!-- visible structure of page begins here --&gt;

    &lt;!-- an element called &#x27;map&#x27; --&gt;
    &lt;div id=&#x27;map&#x27;&gt;&lt;/div&gt;

    &lt;!-- an element called &#x27;info&#x27; --&gt;
    &lt;div id=&#x27;info&#x27;&gt;&lt;/div&gt;

    &lt;!-- load additional javascript --&gt;
    &lt;script src=&#x27;map.js&#x27;&gt;&lt;/script&gt;    

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Notice that we are loading several files within this page (these are in the <code>&lt;link&gt;</code> and <code>&lt;script&gt;</code> tags). These include a css and javascript file from Mapbox, and our own css and javascript files. Some files need to be loaded in a particular order — the reason <code>map.js</code> is loaded within the body and not the head is that it must be loaded <em>after</em> the <code>map</code> and <code>info</code> elements have been created.</p><p>Likewise, put this into your <code>style.css</code> file:</p><pre><code class="language-css">body, html {
    margin: 0;
    padding: 0;
    font-family: monospace;    
}                

#map {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
}

#info {
    position: absolute;
    top: 0;
    right: 0;
    margin: 10px 10px auto auto;    /* top right bottom left */
    padding: 5px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 12px;
    text-align: center;
    color: #222;
    background: #fff;
}

img {
    width: 300px;
}
</code></pre><p>CSS, which stands for Cascading Style Sheets, defines the display properties for each HTML element — that is, how the page <em>looks</em>. At the moment, our page only has two elements, which you see defined here as <code>#map</code> and <code>#info</code>. We also have defined a default width for assets. Note that a comment in css is designated like <code>/* comment */</code>.</p><p>Next, copy the following text into your <code>map.js</code>:</p><pre><code class="language-javascript">console.log(&quot;Hello, world!&quot;)
</code></pre><p>Unlike HTML and css, javascript is a programming language. HTML and css give important information to the browser, but they are like blueprints, whereas javascript is more like a recipe. Javascript will be our focus for the web mapping exercises. We are going to stop short of covering all general programming fundamentals, but you will learn how the various elements function and how to modify code to suit your purposes.</p><p><code>console.log</code> is a debug statement—it lets you write to the javascript console to keep track of what you&#x27;re doing, which is a very helpful tool.</p><p>At this point, we will create a local webserver so that we can view the webpage we just created.</p><h4>Create a local development server using Python:</h4><p><strong>on Mac:</strong></p><ul><li>Open <strong>Terminal</strong>, then test to see what version of Python your computer has installed by typing <code>python -V</code>. Hit enter.</li><li>note whether your computer has python 2 or python 3 installed</li></ul><p><strong>on Windows:</strong></p><ul><li>Open <strong>Command Prompt</strong>, then test to see what version of Python your computer has installed by typing <code>python -V</code>. Hit enter.</li></ul><p>If python is installed on your computer it will tell you which version is installed. Make a note of whether it is Python 2 or python 3.</p><p>If your command prompt/terminal instead says something like <code>&#x27;python&#x27; is not recognized as an internal or external command,
operable program or batch file.</code> then you do not have Python installed and you will need to download it. Follow <a href="https://docs.python-guide.org/starting/install3/win/#install3-windows">these instructions</a> to download Python if it is not already installed.</p><p>Once you have successfully confirmed that you have python installed, we will use it to create a local server to view our website from.</p><p>Navigate to your <code>webmap_1</code> folder from inside your <strong>Terminal</strong> or <strong>Command Prompt</strong>. To do this you will type <code>cd</code> followed by the path to your webmap folder. In my case this was:</p><pre><code>$ cd Documents/webmap_1
</code></pre><p>Once you are inside your <code>webmap_1</code> folder, type the appropriate command for your version of Python in Command Prompt or Terminal:</p><p><strong>Python 3</strong>: <code>python -m http.server</code>
<strong>Python 2</strong>: <code>python -m SimpleHTTPServer</code></p><p>After you hit enter your Terminal/Command Prompt should say something like: <code>Serving HTTP on 0.0.0.0 port 8000 ...</code></p><p>Open your browser and navigate to: <code>http://localhost:8000</code></p><p>On the page itself you should see ... nothing.</p><p>However, in your browser open <code>View &gt; Developer &gt; JavaScript Console</code> <!-- -->. You should see &quot;<a href="https://en.wikipedia.org/wiki/%22Hello,_World!%22_program">Hello, world!</a>&quot; printed. This means that your <code>map.js</code> file has been successfully loaded and you are ready to start programming. If you see any error messages, check the format of your HTML and that the script tag which loads the Mapbox javascript are formatted correctly.</p><p><img src="images/157/webmap_1_02.png" alt="Hello world"/></p><h2>Basic Mapbox GL JavaScript</h2><p>One more setup step: register a <a href="https://www.mapbox.com/signup/">Mapbox</a> account. Then find your &quot;<a href="https://www.mapbox.com/account/">Default public token</a>&quot; under the &quot;Access Tokens&quot; tab, which you will use in your code.</p><p><img src="images/157/webmap_1_2-1.png" alt="Default Token"/></p><p>To begin, replace the debug statement in your map.js file with the following (minus the comments, which in js are designated by a leading <code>//</code>):</p><pre><code class="language-javascript">&#x27;use strict&#x27;        // let the browser know we&#x27;re serious

// debug statement letting us know the file is loaded
console.log(&#x27;Loaded map.js&#x27;)

// your mapbox token
mapboxgl.accessToken = &#x27;YOUR TOKEN HERE BETWEEN THE QUOTES&#x27;
</code></pre><p>You might want to reload your page and check the console to make sure there are no errors—you should just see your debug statement. Now add this to the bottom of your js file:</p><pre><code class="language-javascript">var map = new mapboxgl.Map({
    container: &#x27;map&#x27;,
    style: &#x27;mapbox://styles/mapbox/light-v9&#x27;,
    center: [-73.93324, 40.80877],
    zoom: 14
});
</code></pre><p>Now we&#x27;re cooking with gas. If you reload, you should see a map of Harlem (Web Mercator Projection). Have some fun zooming around.</p><p><img src="images/157/webmap_1_03.png" alt="World map"/></p><p>If you don&#x27;t see a map, make sure you&#x27;ve followed the syntax exactly, and check for errors in your console. When programming, one misplaced character can break the whole thing (watch your commas and brackets!). The <em>block</em> of code we just added creates a new <em>variable</em> <code>map</code> which is a new <em>instance</em> of the <code>Map</code> <em>object</em> provided by the Mapbox javascript file we loaded in our HTML. &quot;map&quot; is actually an arbitrary name—you can choose whatever you want. A <code>Map</code> object has several attributes that we can change: <code>container</code> lets it know the HTML element that will become the map (in this case also called map), <code>style</code> defines a data source for the base map, and <code>center</code> and <code>zoom</code> define the starting coordinates for the map. Change these for <code>map</code> and see what happens.</p><p>Other options for style:</p><pre><code class="language-javascript">style: &#x27;mapbox://styles/mapbox/basic-v9&#x27;,
style: &#x27;mapbox://styles/mapbox/outdoors-v10&#x27;,
style: &#x27;mapbox://styles/mapbox/light-v9&#x27;,
style: &#x27;mapbox://styles/mapbox/dark-v9&#x27;,
style: &#x27;mapbox://styles/mapbox/satellite-v9&#x27;,
style: &#x27;mapbox://styles/mapbox/satellite-streets-v10&#x27;,    
style: &#x27;mapbox://styles/mapbox/navigation-preview-day-v2&#x27;,
style: &#x27;mapbox://styles/mapbox/navigation-preview-night-v2&#x27;,
style: &#x27;mapbox://styles/mapbox/navigation-guidance-day-v2&#x27;,
style: &#x27;mapbox://styles/mapbox/navigation-guidance-night-v2&#x27;,
style: &#x27;mapbox://styles/brianhouse/cjn0u552b52kr2spdz6yhpqj4&#x27;
</code></pre><p>Notice how the last style here is attached to a user account. You can customize your own styles with <a href="https://www.mapbox.com/studio/">Mapbox Studio</a>. Once you create a style, you&#x27;ll just need to find your &quot;Style URL&quot; by clicking &quot;Share <!-- -->&amp;<!-- --> use&quot; and then the &quot;Use&quot; tab and scrolling down.</p><p>There are many other attributes you can add to the Map object, which you can find <a href="https://www.mapbox.com/mapbox-gl-js/api/#map">here</a>.</p><h1>Part 2: Making A Map</h1><h2>Adding geojson data:</h2><p>Now that we have a working webpage and a map object we will add vector data to our map. First a layer with <strong>points</strong> and then one with <strong>polygons</strong>.</p><p>I will use the data that we created in the first tutorial, but you can use any of the data we have used in other tutorials thus far this semester.</p><p>The data must be in <strong>geojson</strong> format and use the <strong>WGS84</strong> geographic coordinate system.</p><p>Create a <code>data</code> folder within the directory you are using to create your web map (in our case within the <code>webmap_1</code> folder).</p><h4>Adding a geojson dataset of points to your map</h4><p>First we will add a <strong>polygon</strong> layer.</p><p>Prepare the polygon dataset you wish to use, use QGIS to export your chosen data in a geojson format that uses the WGS84 geographic coordinate system if it does not already exist in this form.</p><p>Save the geojson file of polygons that you plan to use in the <code>data</code> folder you have just created.</p><p>The instructions below use the processed NYC census blocks dataset that you used in tutorial 1 as an example. It is available in the class <a href="https://drive.google.com/file/d/1txeh8GCmZChtyYQnRPkxPhDyjw7r8mK-/view?usp=sharing">data folder</a>.</p><p>To add your chosen polygon dataset to your map you will need to do three things:</p><ul><li>load the dataset into your map object</li><li>create a new layer containing your geojson data and style it as you would like</li><li>create a function that tells our map object to execute the two actions above when the webpage loads</li></ul><p>First in your <code>map.js</code> file create a variable to hold the url where the dataset you are using is stored. Add this below were you defined your map variable.</p><pre><code class="language-javascript">var blocks_url = &quot;./data/blocks_joined_trees_um.geojson&quot;
</code></pre><p>Next we will use an &quot;object method&quot; that modifies our map <em>object</em> in order to add our dataset onto the map when our webpage loads. Add the following code snippet below the variable you just created with the dataset you are using.   </p><pre><code class="language-javascript">map.on(&#x27;load&#x27;,function(){
  // define a &#x27;source&#x27; for your polygons dataset
  map.addSource(&#x27;blocks_data&#x27;,{
    &#x27;type&#x27;:&#x27;geojson&#x27;,
    &#x27;data&#x27;: blocks_url,
  });
  // add a new layer with your polygons
  map.addLayer({
    &#x27;id&#x27;:&#x27;blocks&#x27;,
    &#x27;type&#x27;:&#x27;fill&#x27;,
    &#x27;source&#x27;:&#x27;blocks_data&#x27;,
    &#x27;paint&#x27;:{
      &#x27;fill-color&#x27;:&#x27;#ffffff&#x27;,
      &#x27;fill-outline-color&#x27;:&#x27;#000000&#x27;,
      &#x27;fill-opacity&#x27;: 0.5
    }
  })
});
</code></pre><p>A few things to note here:</p><ul><li><code>map.on()</code> is a method which listens for a specific type of event, in this case when the page loads (defined because we specified <code>&#x27;load&#x27;</code>). This method waits for whatever we have defined to happen and then executes the <code>&#x27;function&#x27;</code> we define. Here the function adds our datasource, and creates a new layer that shows our data.</li><li>with <code>map.addSource</code> we have defined a new data source and have given it the name <code>&#x27;blocks_data&#x27;</code></li><li>the <code>&#x27;data&#x27;</code> resides at the location we just defined with our variable <code>&#x27;blocks_url&#x27;</code></li><li>with <code>map.addLayer</code> we are defining a new layer that will get added to our map. We have defined the <code>&#x27;id&#x27;</code> to be <code>&#x27;blocks&#x27;</code>. The <code>&#x27;type&#x27;</code> of the layer is <code>&#x27;fill&#x27;</code>. The <code>&#x27;source&#x27;</code> is the <code>&#x27;blocks_data&#x27;</code> source we defined with <code>add.Source</code> above. And finally <code>&#x27;paint&#x27;</code> lets us define how our polygons are drawn.</li></ul><p><strong>Save</strong> your map.js file and reload your browser. You should see the blocks!</p><p><img src="images/157/webmap_1_12.png" alt="blocks"/></p><h4>Adding a geojson dataset of points to your map</h4><p>Next we will add a <strong>point</strong> layer.</p><p>Save the geojson file of points that you plan to use in the <code>data</code> folder you have just created.</p><p>The instructions below use the NYC street trees dataset that you used in tutorial 1 as an example. It is available in the class <a href="https://drive.google.com/file/d/1twTjRQW9kK9IMjAnJ1QgKFtUu4erc8x6/view?usp=sharing">data folder</a>.</p><p>We will repeat the steps above that we used for the polygons:</p><ul><li>load the dataset into your map object</li><li>create a new layer containing your geojson data and style it as you would like.</li></ul><p>First in your <code>map.js</code> file create a new variable containing the url of your point dataset). Place this just below the variable you created for your points dataset.</p><pre><code class="language-javascript">var trees_url = &quot;./data/2015_Street_Tree_Census_subset_um.geojson&quot;
</code></pre><p>Next we will use the <code>.addSource</code> and <code>.addLayer</code> methods to add these points to our map.</p><p>Inside the <code>map.on(&#x27;load&#x27;)</code> function that you defined above include the code snippet below. (Pay careful attention to making sure that you maintain the pairs of brackets and parentheses around each method when you do this).</p><pre><code class="language-javascript">  // define a &#x27;source&#x27; for your point dataset
    map.addSource(&#x27;trees_data&#x27;,{
      &#x27;type&#x27;:&#x27;geojson&#x27;,
      &#x27;data&#x27;: trees_url
    });
    // add a new layer with your points
    map.addLayer({
      &#x27;id&#x27;:&#x27;trees&#x27;,
      &#x27;type&#x27;:&#x27;circle&#x27;,
      &#x27;source&#x27;:&#x27;trees_data&#x27;,
      &#x27;paint&#x27;:{
        &#x27;circle-color&#x27;: &#x27;#349f27&#x27;,
        &#x27;circle-opacity&#x27;:0.7,
        &#x27;circle-radius&#x27;:4
      },
    })

</code></pre><p><strong>Save</strong> your map.js file and reload your browser window. You should see the tree dataset you just added to your map!</p><p><img src="images/157/webmap_1_13.png" alt="Trees"/></p><h2>Data - Driven Styling</h2><p>Now that we have our data on the map, we will want to style it using the data itself, similarly to how we did in QGIS.</p><p>To do this, it may be useful to pull up the QGIS project from the first tutorial so we can reference the variables we styled from, and what the buckets were in each.</p><h4>Styling the block layers</h4><p>In the original tutorial, we joined the street trees dataset to the block groups, and then styled the <strong>fill</strong> of the blockgroups by the average diameter of tree on that block. </p><p>To do this in Mapbox GL JS, we fill just edit the <code>fill-color</code> property to have multiple steps, with colors associated for each. Copy and paste this over your entire <code>block_data</code> source + layer:</p><pre><code class="language-javascript"> // add a new layer with your polygons
  map.addLayer({
    &#x27;id&#x27;:&#x27;blocks&#x27;,
    &#x27;type&#x27;:&#x27;fill&#x27;,
    &#x27;source&#x27;:&#x27;blocks_data&#x27;,
    &#x27;paint&#x27;:{
        &#x27;fill-color&#x27;: 
          [&#x27;case&#x27;, 
          [&#x27;==&#x27;, [&#x27;get&#x27;, &#x27;avg_diamet&#x27;], null],
          &#x27;white&#x27;,
          [&#x27;step&#x27;, [&#x27;get&#x27;, &#x27;avg_diamet&#x27;],
            &#x27;#ffffff&#x27;,
            2.615, &#x27;#edf8e9&#x27;,
            6.444, &#x27;#bae4b3&#x27;,
            9.379, &#x27;#74c476&#x27;,
            15.036, &#x27;#31a354&#x27;,
            26.000, &#x27;#006d2c&#x27;
          ]],
      &#x27;fill-outline-color&#x27;:&#x27;#000000&#x27;,
      &#x27;fill-opacity&#x27;: 0.5
    }
  })
</code></pre><p>  There are a couple of things going on here:</p><ul><li>Instead of giving a single value for <code>fill-color</code>, we are styling across a property, which in this case is &#x27;avg_diamet&#x27;. If nothing is showing for you, first check that your variable is named the same thing.</li><li>We <code>get</code> that variable with <code>[&#x27;step&#x27;, [&#x27;get&#x27;, &#x27;avg_diamet&#x27;]</code>, followed by our values. The first value, <code>#ffffff</code> is a fallback for 0, and the rest are the <code>avg_diamet</code> values I copied over from QGIS, followed by their respective color.</li><li>While I could have copied over colors from QGIS, I used <a href="https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=5">ColorBrewer2</a> for map styles. </li><li>The three lines that start with <code>[&#x27;case</code> perform the function of sorting out null values from the dataset, and making them white. Without this Mapbox would default to making them black. </li><li>Lastly, there are many ways to do this correctly, this is just one of them. Don&#x27;t get caught up too much in the specific syntax of this example and don&#x27;t worry if you find something different online, both will probably work.</li></ul><p>Save your map, refresh if you need to, and you should see this:</p><p><img src="images/157/webmap_1_14.png" alt="BlockDataStyle"/></p><h4>Styling the tree layers.</h4><p>Next, we will style the tree layers.</p><p>This will be a bit more straight forward, because we are styling a numeric property, <code>circle-radius&#x27;, with another numeric property from our dataset </code>tree_dbh`.</p><p> Copy and paste this over your entire <code>trees_data</code> source + layer:</p><pre><code class="language-javascript">   // define a &#x27;source&#x27; for your point dataset
    map.addSource(&#x27;trees_data&#x27;,{
      &#x27;type&#x27;:&#x27;geojson&#x27;,
      &#x27;data&#x27;: trees_url
    });
    // add a new layer with your points
    map.addLayer({
      &#x27;id&#x27;:&#x27;trees&#x27;,
      &#x27;type&#x27;:&#x27;circle&#x27;,
      &#x27;source&#x27;:&#x27;trees_data&#x27;,
      &#x27;paint&#x27;:{
        &#x27;circle-color&#x27;: &#x27;#349f27&#x27;,
        &#x27;circle-opacity&#x27;:0.7,
        &#x27;circle-radius&#x27;: [&#x27;/&#x27;, [&#x27;get&#x27;, &#x27;tree_dbh&#x27;], 5],
      },
    })
</code></pre><p>Here, all of the styling takes place in <code>&#x27;circle-radius&#x27;: [&#x27;/&#x27;, [&#x27;get&#x27;, &#x27;tree_dbh&#x27;], 5],</code>. Originally I had <code>&#x27;circle-radius&#x27;: [&#x27;get&#x27;, &#x27;tree_dbh&#x27;],</code> which made the mapbox radius unit exactly the tree diameter in feet contained in the <code>tree_dbh</code> variable. This was comically large, so I the code around it divided that value by 5.</p><p>After you&#x27;ved added that, your map should look like this. </p><p><img src="images/157/webmap_1_15.png" alt="TreeDataStyle"/></p><p>Looks like I have a giant tree on 117th street, this could be the result of either an error in the original datset, an error in how we processed it, or a giant tree on 117th street that I haven&#x27;t noticed before. You could fix this by either editing it in the dataset itself, or if it was important for you to maintain a direct proportion to the actual tree diameter, you could change the styling of <code>circle-radius</code> to buckets instead of a linear scale (like we did in QGIS.)</p><h4>Styling alternatives</h4><p>If you find all of that styling tedious, you&#x27;re not alone! Luckily Mapbox also has a GUI that allows you to style a map called <a href="https://studio.mapbox.com/">Mapbox Studio</a>. There, you can style a layer, and then add it to your <code>map.js</code> using it&#x27;s <code>tilesetID</code>.
This is sometimes quicker for simple maps with precise styling, but you lose some potential for interactiviy in the procress. <a href="https://docs.mapbox.com/mapbox-gl-js/example/vector-source/">Here</a> is the Mapbox Documentation for that workflow.</p><h2>Pushing to Github</h2><p>Once you have created an map that you like lets publish it online by <code>pushing</code> our changes to GitHub. Open your terminal or command prompt. Make sure you are within the folder where you created your web map (in our case <code>webmap_1</code>).  </p><ul><li>Type <code>git add -A</code> to &#x27;track&#x27; all of the changes you made.   </li><li>To commit your changes type <code>git commit -m &quot;some note about the changes you made&quot;</code> and replace the information within the quotes with some note to yourself about the changes you made.  </li><li>Then push your changes to the server by typing <code>git push</code>.</li></ul><p>Visit your repository website at <code>yourgithubusername.github.io/webmap_1</code> to check that all changes were pushed correctly.</p><h2>Adding Interactivity</h2><p>After completing the above portions of this tutorial you now should have a functioning web map. Congrats! With the help of some Javascript, we managed to get something similar to our QGIS static map onto the web by defining its content (raster and vector data) and style (symbology). Here we&#x27;ll start to look at where Javascript really shines: defining behavior, interactivity and change over time in your web map.</p><h2>About Events</h2><p>One of the simplest forms of interactivity is to have something happen when you click an element on the page, or in this case, our map. Javascript uses the concept of <strong>events</strong> to define this kind of behavior. This is a two-part approach: you first need to designate an element on your page as an event <strong>listener</strong>, then provide instructions in the form of an event <strong>handler</strong> that say what to do when the event takes place. A basic example would look something like this:</p><pre><code class="language-javascript">// listen for &#x27;onclick&#x27; events from &#x27;handler-element&#x27;
document.getElementById(&#x27;handler-element&#x27;).onclick = handleEvent;

// say how to handle the events that are fired by the listener
function handleEvent(e) {
  console.log(&quot;an event happened&quot;)
}
</code></pre><p>Once the browser loads this bit of code, every time the user clicks a page element with the given ID an event will be fired and the code inside the event handler will be executed. We&#x27;re not using it here but notice that the event handler is being passed an object <code>e</code> that we can use to get information about the element being clicked, where the cursor was on the screen at the time, and other useful things.</p><p>This is a good start but it&#x27;s not going to get us very far when we&#x27;re dealing with even a modestly-sized collection of map data. Consider the street trees we added to our web map in the last tutorial. If we wanted to create a pop-up label with the tree species every time a different tree was clicked, how would we do it?</p><p>Doing this with the pattern described above, we&#x27;d need to first create event listeners on each individual point. Even though we&#x27;d be able to reuse the same event handler function for each one, it&#x27;d also be a lot of work to, say, create a pop-up with the species name of the tree each time it was clicked. We&#x27;d need to first unpack the <code>e</code> object to access the properties of the clicked element, then relate it somehow to the original dataset, traverse the list of properties and get the value of the species name - all that before even starting to think about how to create and style a new page element with the name written in it, and to give ourselves some mechanism to make it go away once we don&#x27;t want it anymore.</p><h2>Making Popups on Click Events with Mapbox GL</h2><p>Fortunately, Mapbox GL provides us with a bunch of readymade objects and functions so we don&#x27;t need to reinvent the wheel. Remember from last time that in order to create a map on our page we&#x27;re making a new <code>Map</code> object using the library. We used <code>on(&#x27;load&#x27;, ...)</code>, which is an all-in-one event listener and handler, <code>addSource()</code> and <code>addLayer()</code> functions that are part of the <code>Map</code> object to describe and render the map. We can use different versions of that same <code>on()</code> function to automatically create event patterns for every element in a map layer, and Mapbox&#x27;s <code>Popup</code> object can help us with creating the pop-up itself. Copy and paste the following sample code into your map.js file:</p><pre><code class="language-javascript">// when the user does a &#x27;click&#x27; on an element in the &#x27;trees&#x27; layer...
map.on(&#x27;click&#x27;, &#x27;trees&#x27;, function(e) {
  // get the map coordinates of the feature
  var coordinates = e.features[0].geometry.coordinates.slice();
  // get its species name from the feature&#x27;s attributes
  var species = e.features[0].properties.spc_common;

  // and create a popup on the map
  new mapboxgl.Popup()
  .setLngLat(coordinates)
  .setHTML(species)
  .addTo(map);
});
  
// make the cursor a pointer when over the tree
map.on(&#x27;mouseenter&#x27;, &#x27;trees&#x27;, function() {
  map.getCanvas().style.cursor = &#x27;pointer&#x27;;
});
  
// back to normal when it&#x27;s not
map.on(&#x27;mouseleave&#x27;, &#x27;trees&#x27;, function() {
  map.getCanvas().style.cursor = &#x27;&#x27;;
});
</code></pre><p>Now you should see a popup appear with the tree&#x27;s species name whenever you click a tree on the map. Clicking another tree or clicking the &#x27;x&#x27; on the popup should make the last popup disappear. Not bad for a couple lines of code. Notice that we can also control the appearance of the cursor to give the user a hint that some kind of interactivity is now built into the tree symbols. Thanks to the features in the library, we&#x27;re able to do a surprising amount of work with just a couple of lines of code.</p><p><img src="images/157/mapboxgl_popup.png" alt="Street trees with popup tags"/></p><h2>Other Mapbox GL Examples</h2><p>Now that we&#x27;ve seen the basics of how to define map behavior using functions in the Mapbox GL library, you can experiment with some of the many <a href="https://docs.mapbox.com/mapbox-gl-js/examples/">examples</a> they provide and try to adapt them to your map. Here are a few suggestions:</p><ul><li>You can <a href="https://docs.mapbox.com/mapbox-gl-js/example/adjust-layer-opacity/">adjust the opacity of a raster layer</a> using the <code>value</code> property of a targeted slider to as an input to the map&#x27;s <code>setPaintProperty()</code> function. Note that this example uses the plain Javascript event pattern outlined above since the behavior is for a single element outside of the map itself.</li><li>Or you can <a href="https://docs.mapbox.com/mapbox-gl-js/example/animate-point-along-line/">animate features on the map</a> using two custom functions - one that defines position as a function of time and another which steps through frames of an animation, updating the position of an element with <code>Map.getSource(...).setData(...)</code> each time it runs.</li><li>Or <a href="https://docs.mapbox.com/mapbox-gl-js/example/flyto-options/">animate the &#x27;camera&#x27;</a> with the <code>flyTo()</code> function which gradually changes the <code>center</code> and <code>zoom</code> properties of the <code>Map</code> over time.</li></ul><h2>Using API Documentation</h2><p>As you start thinking about how you might want to develop your map further, you&#x27;ll want to know more about what else you can do with MapboxGL. At a certain point, working through examples and tutorials will cease to be useful and you&#x27;ll want a more direct way to explore what&#x27;s available. Fortunately, every legitimate Javascript library comes with a catalog in the form of its <strong>API documentation</strong>. Sometimes you&#x27;ll see this referred to as &quot;the docs&quot; for short, and it&#x27;s always going to be the most detailed, comprehensive, up-to-date, and accurate source for information on the contents of a given library and how it&#x27;s meant to be used.</p><p>All of the objects, functions and properties in the library will be listed and described, often with examples, in a single online resource. So for example, if you wanted more details on how the <code>flyTo</code> function in the last example, you&#x27;d find it <a href="https://docs.mapbox.com/mapbox-gl-js/api/#map#flyto">here</a> under the instance members of the Map object. Not all API docs will do this, but Mapbox includes both links to related examples and short code snippets, which makes it even easier to learn. Feel free to explore this at your own pace and try adding some additional functionality to your map if you have the time and interest.</p><h2>Full Code</h2><p>Here is what your full map.js should look like in the end, and here is a <a href="https://adamvosburgh.github.io/webmap_1/">live demo</a> of it as well. Don&#x27;t forget to put in your mapbox token!</p><pre><code class="language-javascript">&#x27;use strict&#x27;        // let the browser know we&#x27;re serious

// debug statement letting us know the file is loaded
console.log(&#x27;Loaded map.js&#x27;)

// your mapbox token
mapboxgl.accessToken = &#x27;YOUR TOKEN HERE&#x27;

var map = new mapboxgl.Map({
    container: &#x27;map&#x27;,
    style: &#x27;mapbox://styles/mapbox/light-v9&#x27;,
    center: [ -73.94829, 40.80781],
    zoom: 13.75
});

var blocks_url = &quot;./data/blocks_joined_trees_um.geojson&quot;
var trees_url = &quot;./data/2015_Street_Tree_Census_subset_um.geojson&quot;

map.on(&#x27;load&#x27;,function(){
  // define a &#x27;source&#x27; for your polygons dataset
  map.addSource(&#x27;blocks_data&#x27;,{
    &#x27;type&#x27;:&#x27;geojson&#x27;,
    &#x27;data&#x27;: blocks_url,
  });
  // add a new layer with your polygons
  map.addLayer({
    &#x27;id&#x27;:&#x27;blocks&#x27;,
    &#x27;type&#x27;:&#x27;fill&#x27;,
    &#x27;source&#x27;:&#x27;blocks_data&#x27;,
    &#x27;paint&#x27;:{
        &#x27;fill-color&#x27;: 
          [&#x27;case&#x27;, 
          [&#x27;==&#x27;, [&#x27;get&#x27;, &#x27;avg_diamet&#x27;], null],
          &#x27;white&#x27;,
          [&#x27;step&#x27;, [&#x27;get&#x27;, &#x27;avg_diamet&#x27;],
            &#x27;#ffffff&#x27;,
            2.615, &#x27;#edf8e9&#x27;,
            6.444, &#x27;#bae4b3&#x27;,
            9.379, &#x27;#74c476&#x27;,
            15.036, &#x27;#31a354&#x27;,
            26.000, &#x27;#006d2c&#x27;
          ]],
      &#x27;fill-outline-color&#x27;:&#x27;#000000&#x27;,
      &#x27;fill-opacity&#x27;: 0.5
    }
  })
  // define a &#x27;source&#x27; for your point dataset
    map.addSource(&#x27;trees_data&#x27;,{
      &#x27;type&#x27;:&#x27;geojson&#x27;,
      &#x27;data&#x27;: trees_url
    });
    // add a new layer with your points
    map.addLayer({
      &#x27;id&#x27;:&#x27;trees&#x27;,
      &#x27;type&#x27;:&#x27;circle&#x27;,
      &#x27;source&#x27;:&#x27;trees_data&#x27;,
      &#x27;paint&#x27;:{
        &#x27;circle-color&#x27;: &#x27;#349f27&#x27;,
        &#x27;circle-opacity&#x27;:0.7,
        &#x27;circle-radius&#x27;: [&#x27;/&#x27;, [&#x27;get&#x27;, &#x27;tree_dbh&#x27;], 5],
      },
    })
    
  });
  
  // when the user does a &#x27;click&#x27; on an element in the &#x27;trees&#x27; layer...
map.on(&#x27;click&#x27;, &#x27;trees&#x27;, function(e) {
    // get the map coordinates of the feature
    var coordinates = e.features[0].geometry.coordinates.slice();
    // get its species name from the feature&#x27;s attributes
    var species = e.features[0].properties.spc_common;
  
    // and create a popup on the map
    new mapboxgl.Popup()
    .setLngLat(coordinates)
    .setHTML(species)
    .addTo(map);
  });
    
  // make the cursor a pointer when over the tree
  map.on(&#x27;mouseenter&#x27;, &#x27;trees&#x27;, function() {
    map.getCanvas().style.cursor = &#x27;pointer&#x27;;
  });
    
  // back to normal when it&#x27;s not
  map.on(&#x27;mouseleave&#x27;, &#x27;trees&#x27;, function() {
    map.getCanvas().style.cursor = &#x27;&#x27;;
  });
  
</code></pre><hr/><p>Tutorial by Adam Vosburgh, Spring 2022.<br/>
<!-- -->Adapted from tutorial written by Dare Brawley, Spring 2020 &amp; by Brian House for Mapping for Architecture, Urbanism, and the Humanities, Fall 2018.</p></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/resources/webmap-1/";window.___webpackCompilationHash="5ef13f30bb042eea8b82";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-c1bb7402650398ed2529.js"],"component---src-pages-404-js":["/component---src-pages-404-js-76786e7c991583d34bda.js"],"component---src-pages-assignments-index-js":["/component---src-pages-assignments-index-js-00d6b308b12869a8a507.js"],"component---src-pages-assignments-mdx-slug-js":["/component---src-pages-assignments-mdx-slug-js-399bf7df8917ed794382.js"],"component---src-pages-index-js":["/component---src-pages-index-js-558145594703b94cf121.js"],"component---src-pages-resources-index-js":["/component---src-pages-resources-index-js-9d27da2f286c26fa2c6a.js"],"component---src-pages-resources-mdx-slug-js":["/component---src-pages-resources-mdx-slug-js-b0c0e9c415dc8572964d.js"],"component---src-pages-tutorials-index-js":["/component---src-pages-tutorials-index-js-55869d6279a4259c8314.js"],"component---src-pages-tutorials-mdx-slug-js":["/component---src-pages-tutorials-mdx-slug-js-81b43aac03f1edf05ff8.js"]};/*]]>*/</script><script src="/methods-in-spatial-research-sp2024/app-c1bb7402650398ed2529.js" async=""></script><script src="/methods-in-spatial-research-sp2024/framework-d10acee82f9972a347d6.js" async=""></script><script src="/methods-in-spatial-research-sp2024/webpack-runtime-7907f3b16731628f77c4.js" async=""></script></body></html>